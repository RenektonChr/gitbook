# 手摸手从零实现前端监控SDK



## 零、写在前面

前端开发者如果想找一个比较好的公司或者团队，在面试中展示自己，或者想跟面试官侃侃而谈的时候，如果缺了前端性能监控这一块，那么就会稍微显得有些不足。那么如果想在前端性能这一方面跟别人吹点儿干货，那么就要有一些自己实实在在的东西。毫无疑问前端性能监控的SDK是一个大杀器。

通过手动实现前端性能监控的SDK我们也可以对前端的性能优化的技术指标有一个非常清晰的认知。



## 一、你必须知道的概念

**核心的概念：**

+ **TTFB：**Time To First Byte，首字节时间。
+ **FP：**First Paint，首次绘制。
+ **FCP：**First Content Paint，首次有内容的绘制。
+ **FMP：**First Meaningful Paint，首次有意义的绘制。**（注意：这个指标已经废弃了！！）**
+ **TTI：**Time To Interactive，可交互时间。
+ **Long tasks：**超过50ms的任务。
+ **SSR&&CSR：**服务端渲染和客户端渲染。
+ **Isomorphic JavaScript：**同构化。



**必须知道的概念：**

+ **LCP（Largest Contentful Paint）：**最大内容绘制，用于记录视窗内最大元素的绘制时间。该时间会随着页面渲染的变化而变化，因为视窗内的最大元素在渲染过程中可能会发生变化，另外该指标会在用户第一次交互后停止记录。
+ **FID（First Input Delay）：**首次输入延迟。记录在FCP和TTI之间用户首次与页面交互时响应的延迟。React中的Fiber专门解决FID。
+ **TBT（Total Blocking Time）：**阻塞总时间。记录FCP和TTI之间所有长任务的阻塞时间的总和。
+ **CLS（Cumulative Layout Shift）：**累计位移偏移。记录了页面上非预期的位移波动。使用按钮动态添加了某个元素，导致了页面上其他元素的位置发生了偏移。造成了页面看着不爽。CLS代表了页面的稳定指标。



**核心的任务指标：**

+ **LCP：**LCP代表了页面的速度指标，能体现的东西更多一些。一是指标实时更新，数据更精确。二是代表页面最大元素的渲染时间，最大元素的快速载入能让用户感觉性能还挺好。
+ **FID：**FID代表页面的交互体验指标，交互响应的快会让用户觉得网页流畅。
+ **CLS：**CLS代表了页面的稳定指标，尤其在手机上这个指标更为重要。因为手机屏幕挺小，CLS的值如果过大会让用户觉得页面体验做的很差。



如果想要知道这些指标的详细情况，可以看一下Chrome的[WebDev官网](https://web.dev/)了解一下。

如果想要统计这些性能指标，浏览器也提供了很多API，这些API都是FRP的形式，也就是说全部都是响应式编程，是一些Observe。比如说我们想要统计一下FP和FCP这两个指标我们就可以使用对应的API进行统计。

+ IntersectionObserver
+ PerformanceObserver
+ Performance.timing：这个主要统计的是一些同步的数据，Observe统计的是异步的数据。

我们来写一个Demo，监听用户数据指标：

```html
```



