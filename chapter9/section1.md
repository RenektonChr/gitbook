# å‰åç«¯å®ç°BFFæ¶æ„ï¼ˆä¸€ï¼‰

* BFFæ¶æ„çš„å‰ç½®å‡†å¤‡
* ä»€ä¹ˆæ˜¯BFF
* BFFæ¶æ„é¡¹ç›®ç›®å½•



## é›¶ã€BFFæ¶æ„çš„å‰ç½®å‡†å¤‡

### Iã€ç†è§£MVCåˆ†å±‚çš„è®¾è®¡åŸç†

### IIã€ç†Ÿæ‚‰HTTPåè®®

### IIIã€ç†Ÿæ‚‰KOAå…¨å®¶æ¡¶

* Koa
* Koa-router
* Koa-static
* swigæ¨¡æ¿
* é¡¹ç›®çƒ­æ›´æ–°
  * å¼€å‘ç¯å¢ƒä½¿ç”¨nodemon
  * ç”Ÿäº§ç¯å¢ƒä½¿ç”¨pm2
* å‰ç«¯æ¨¡å—åŒ–æ–¹æ¡ˆ
  * CMD
  * AMD
  * UMD
  * ESModules
* SystemJS



## ä¸€ã€ä»€ä¹ˆæ˜¯BFFæ¶æ„

BFFï¼ˆBackends for Frontendsï¼‰æ˜¯æœåŠ¡äºå‰ç«¯çš„åç«¯åº”ç”¨ç¨‹åºï¼Œä¸»è¦æ˜¯ç”¨æ¥è§£å†³å¤šè®¿é—®ç»ˆç«¯çš„æ„ä¸šåŠ¡è€¦åˆé—®é¢˜ã€‚åœ¨æ—¥å¸¸çš„éœ€æ±‚å½“ä¸­å¾ˆå®¹æ˜“å‡ºç°å¤šç»ˆç«¯è®¿é—®æ¥å£çš„æƒ…å†µï¼Œä½†æ˜¯æ¯ç§ç»ˆç«¯çš„ä¸šåŠ¡åœºæ™¯åˆå¾ˆä¸ç›¸åŒï¼Œæ¯”å¦‚webå¤§å¤šæ•°åœºæ™¯æ˜¯ç”¨æ¥ç®¡ç†æ•°æ®ï¼Œä½†æ˜¯ç§»åŠ¨ç«¯ä»…ä»…æ˜¯æ•°æ®çš„é‡‡é›†å’Œå±•ç¤ºï¼Œæ‰€ä»¥æ¥å£çš„è®¾è®¡ä¸€èˆ¬æ˜¯å’Œç»ˆç«¯çš„ä¸šåŠ¡é€»è¾‘æœ‰ç€é«˜åº¦çš„è€¦åˆï¼Œå¾ˆéš¾é‡ç”¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾®æœåŠ¡æ¶æ„ä¸­å°±æå‡ºäº†BFFæ¶æ„ï¼Œä¸ºä¸åŒçš„ç»ˆç«¯è®¾è®¡ä¸€å±‚BFFã€‚  

å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šä¸ºæ¯ä¸ªç«¯è®¾è®¡ç›¸åº”çš„BFFï¼Œæ¯ä¸ªç«¯çš„`BFF`å¤„ç†è‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦æ•°æ®æ—¶ä»`åŸºç¡€æœåŠ¡`å†…è·å–ï¼Œç„¶ååœ¨æ¥å£è¿”å›ä¹‹å‰è¿›è¡Œç»„è£…æ•°æ®ç”¨äºå®ä¾‹åŒ–è¿”å›å¯¹è±¡ã€‚  

è¿™æ ·åŸºç¡€æœåŠ¡å¦‚æœæœ‰æ–°åŠŸèƒ½æ·»åŠ ï¼Œ`BFF`å‡ ä¹ä¸ä¼šå—åˆ°å½±å“ï¼Œè€Œæˆ‘ä»¬å¦‚æœåæœŸæŠŠ`App`ç«¯ç‚¹è¿›è¡Œæ‹†åˆ†æˆ`Android`ã€`IOS`æ—¶æˆ‘ä»¬åªéœ€è¦å°†`app-bff`è¿›è¡Œæ‹†åˆ†ä¸º`android-bff`ã€`ios-bff`ï¼ŒåŸºç¡€æœåŠ¡åŒæ ·ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚

è¿™æ ·æ¯å½“æ–°å¢ä¸€ä¸ªè®¿é—®ç«¯ç‚¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ä¹Ÿåªæœ‰`ç½‘å…³çš„è½¬å‘`ä»¥åŠ`æ·»åŠ ä¸€ä¸ªBFF`å³å¯ï¼Œ`åŸºç¡€æœåŠ¡`å†…æä¾›çš„æœåŠ¡æ¥å£æˆ‘ä»¬å®Œå…¨å¯ä»¥å¤ç”¨ï¼Œå› ä¸º`åŸºç¡€æœåŠ¡`æä¾›çš„æ¥å£éƒ½æ˜¯æ²¡æœ‰ä¸šåŠ¡é’ˆå¯¹æ€§çš„ï¼Œæ€»çš„æ¥è¯´BFFè§£å†³äº†ä¸šåŠ¡åœºæ™¯çš„é—®é¢˜ã€‚  

### BFFçš„ç¼ºç‚¹

* å“åº”æ—¶é—´å»¶è¿Ÿï¼ˆæœåŠ¡å¦‚æœæ˜¯å†…ç½‘ä¹‹é—´è®¿é—®ï¼Œå»¶è¿Ÿæ—¶é—´è¾ƒä½ï¼‰ã€‚
* å¢åŠ äº†ä»£ç é‡ï¼Œç¼–å†™èµ·æ¥è¾ƒä¸ºæµªè´¹æ—¶é—´ï¼ˆå› ä¸ºåœ¨åŸºç¡€æœåŠ¡ä¸Šæ·»åŠ çš„ä¸€å±‚è½¬å‘ï¼Œæ‰€ä»¥ä¼šå¤šå†™ä¸€éƒ¨åˆ†ä»£ç ï¼‰ã€‚
* ä¸šåŠ¡å¼‚å¸¸å¤„ç†ï¼ˆç»Ÿä¸€æ ¼å¼åŒ–ä¸šåŠ¡å¼‚å¸¸çš„è¿”å›å†…å®¹ï¼‰ã€‚
* åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¾®æœåŠ¡çš„é€šç—…ï¼‰ã€‚

## äºŒã€BFFæ¶æ„ç›®å½•

### Iã€BFFç›®å½•æ ‘

BFF-Project  
â”œâ”€â”€ .gitignore  
â”œâ”€â”€ app.js   
â”œâ”€â”€ assets    
â”œâ”€â”€ components  
â”œâ”€â”€ config  
â”œâ”€â”€ controllers   
â”œâ”€â”€ middleware  
â”œâ”€â”€ models   
â”œâ”€â”€ package.json  
â”œâ”€â”€ tests  
â”œâ”€â”€ tree.md  
â”œâ”€â”€ utils   
â”œâ”€â”€ views  
â””â”€â”€ yarn.lock   



### IIã€ç›®å½•ç»“æ„è¯¦è§£

* .gitignore

  è¿™æ˜¯ä¸€ä¸ªgitä¸Šä¼ çš„å¿½ç•¥æ–‡ä»¶ï¼Œä¸»è¦å¿½ç•¥ä¸€äº›ä¸éœ€è¦ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ï¼ˆæ¯”å¦‚è¯´githubã€gitlabç­‰ç­‰ï¼‰çš„æ–‡ä»¶æˆ–è€…ç›®å½•ï¼ˆæ¯”å¦‚è¯´node_moudlesï¼‰ã€‚

* app.js

  app.jsæ–‡ä»¶æ˜¯æ•´ä¸ªé¡¹ç›®çš„å…¥å£ï¼Œé‡Œé¢ä¸»è¦æ˜¯ç¼–å†™äº†åç«¯httpæœåŠ¡å™¨çš„è¿è¡Œä»£ç ã€‚

* assets

  assetsç›®å½•ä¸»è¦æ˜¯å­˜æ”¾æ•´ä¸ªé¡¹ç›®é™æ€æ–‡ä»¶ï¼Œæœ‰vueå¼€å‘ç»éªŒçš„å°ä¼™ä¼´å¯ä»¥å¯¹æ¯”vueä¸­çš„assetsç›®å½•è¿›è¡Œç†è§£ã€‚é‡Œé¢ä¸»è¦å­˜æ”¾é¡¹ç›®ä¸­æ‰€éœ€çš„å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€cssæ–‡ä»¶ç­‰ç­‰ã€‚

* components

  è§åçŸ¥æ„ï¼Œcomponentsç›®å½•ä¸»è¦å­˜æ”¾çš„æ˜¯é¡¹ç›®ä¸­ç”¨åˆ°çš„ç»„ä»¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªç»„ä»¶ä»ç„¶æ˜¯å‰ç«¯ç»„ä»¶çš„æ¦‚å¿µã€‚

* config

  configç›®å½•ä¸»è¦å­˜æ”¾é¡¹ç›®çš„å„ç§é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶é…ç½®çš„ä¸€èˆ¬æ˜¯ä¸åŒç¯å¢ƒä¸‹çš„ç›¸åŒé…ç½®ï¼Œä»¥åŠæ ¹æ®ä¸åŒç¯å¢ƒçš„ä¸ªæ€§åŒ–ç§æœ‰é…ç½®ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ç¯å¢ƒåˆ†ä¸ºdevelopmentï¼ˆå¼€å‘ç¯å¢ƒï¼‰ã€testï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰ã€productionï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼Œè¿™äº›ç¯å¢ƒä¸‹httpæœåŠ¡å™¨çš„è¿è¡Œç«¯å£æ˜¯ä¸ä¸€æ ·çš„ï¼Œé‚£ä¹ˆç«¯å£å·åˆ™æ˜¯æ ¹æ®ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒçš„é…ç½®ï¼ˆè¿™é‡Œç«¯å£å·å°±å±äºä¸åŒç¯å¢ƒä¸‹çš„ä¸ªæ€§åŒ–é…ç½®ï¼‰ï¼Œä¸ä¹‹ç›¸å¯¹çš„å°±æ˜¯å…¬å…±é…ç½®ï¼Œä¾‹å¦‚é™æ€æ–‡ä»¶çš„åœ°å€ï¼Œæ— è®ºä»€ä¹ˆç¯å¢ƒï¼Œé™æ€æ–‡ä»¶çš„åœ°å€ä¸€èˆ¬éƒ½æ˜¯ç›¸åŒçš„ã€‚

* controllers

  controllersç›®å½•å­˜æ”¾çš„æ˜¯å¯¹äºåç«¯è·¯ç”±çš„ç®¡ç†ï¼Œè¿™é‡Œçš„è·¯ç”±æŒ‡çš„æ˜¯ä¸¤ç§ç±»å‹çš„è·¯ç”±ï¼Œç¬¬ä¸€æ˜¯é¡µé¢çš„æ¸²æŸ“è·¯ç”±ï¼Œæ¯”å¦‚è¯´ä½ åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥www.baidu.comï¼Œå›è½¦å°±èƒ½çœ‹åˆ°ç™¾åº¦çš„é¦–é¡µä¸€æ ·ã€‚ç¬¬äºŒç§æ˜¯æ¥å£çš„è·¯ç”±ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ¥å£çš„è·¯ç”±ç”¨äºå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œæˆ‘ä»¬éšåä¹Ÿä¼šè®²è§£ã€‚æ€»ç»“ä¸‹æ¥å°±ä¸€å¥è¯ï¼Œcontrollersé‡Œé¢çš„é€»è¾‘å°±æ˜¯å¯¹äºè·¯ç”±çš„ç®¡ç†ï¼Œå°±æ˜¯MVCç»“æ„ä¸­çš„Cï¼ˆControllerï¼‰å±‚ã€‚

* middleware

  middlewareç›®å½•ä¸ºä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶å¯ä»¥ç†è§£ä¸ºç”¨äºæ‰©å±•åŠŸèƒ½çš„å¯æ‹†è£…æ¨¡å—ã€‚æ¯”å¦‚å¯¹äºkoaæ¡†æ¶æ¥è¯´ï¼Œkoaåªæ˜¯å®ç°äº†ä¸€äº›æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œåƒè·¯ç”±çš„åŠŸèƒ½æˆ‘ä»¬å°±è¦ä¾é koa-routerä¸­é—´ä»¶ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸­é—´ä»¶ï¼Œmiddlewareä¸€èˆ¬ç”¨æ¥å­˜æ”¾ä¸€äº›è‡ªå®šä¹‰çš„ä¸­é—´ä»¶ã€‚

* models

  moddlesä¸»è¦æ˜¯å¤„ç†æ•°æ®ç›¸å…³çš„é€»è¾‘ï¼ŒBFFæ¶æ„ä¸­æˆ‘ä»¬ä½¿ç”¨nodeåšä¸­é—´å±‚ï¼Œè¿™é‡Œçš„modelsä¸»è¦æ˜¯å¤„ç†å‘åç«¯è¯·æ±‚æ•°æ®çš„é€»è¾‘ï¼Œå¯¹åº”äº†MVCä¸­çš„Mï¼ˆModelï¼‰å±‚ã€‚

* tests

  testsç›®å½•ä¸»è¦æ˜¯å­˜æ”¾ä¸€äº›æµ‹è¯•æ–‡ä»¶ã€‚æˆ‘åœ¨å‰ç«¯æµ‹è¯•ä¼šç€é‡è®²è§£ã€‚

* utils

  utilsç›®å½•å­˜æ”¾çš„æ˜¯å…¬å…±æ–¹æ³•

* views

  viewsç›®å½•å­˜æ”¾çš„æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨å‘é€åˆ°æµè§ˆå™¨ç«¯ï¼Œç”±æµè§ˆå™¨è¿›è¡Œæ¸²æŸ“åç”¨æˆ·æœ€ç»ˆçœ‹åˆ°çš„ç»“æœã€‚ç”±Controllerå±‚æ§åˆ¶è·¯ç”±ï¼Œç„¶åæ¸²æŸ“è·¯ç”±å¯¹åº”çš„æ¨¡æ¿ï¼Œè¿™é‡Œcotrolleræ¸²æŸ“çš„å†…å®¹å°±æ˜¯viewsä¸­çš„æŸä¸€ä¸ªæ¨¡æ¿ã€‚è¿™ä¹Ÿå°±å¯¹åº”äº†MVCä¸­çš„Vï¼ˆViewï¼‰å±‚ã€‚

* package.json

  Package.jsonæ–‡ä»¶æ˜¯å½“å‰é¡¹ç›®æ‰€ç”¨åˆ°çš„æ‰€æœ‰åŒ…çš„é…ç½®æ–‡ä»¶ã€‚ç›¸å½“äºä¸€ä¸ªåŒ…çš„æ˜ç»†ã€‚npm installå‘½ä»¤å°±æ˜¯æ ¹æ®è¿™ä¸ªæ–‡ä»¶ä»npmæœåŠ¡å™¨ä¸­ä¸‹è½½å¯¹åº”çš„åŒ…ã€‚



## ä¸‰ã€ä½¿ç”¨NodeJSå®ç°BFFæ¶æ„

### Iã€åŠ¨æ‰‹ä¹‹å‰

è¿™é‡Œé¦–å…ˆè¦äº¤ä»£çš„æ˜¯ï¼Œæœ¬æ–‡å®ç°BFFæ¶æ„ç”¨çš„æ˜¯Koaå…¨å®¶æ¡¶ã€‚  

* httpæœåŠ¡å™¨ï¼šKoa2
* è·¯ç”±ï¼š@koa-router
* æ¨¡æ¿ï¼šswig
* é™æ€æ–‡ä»¶å¤„ç†ï¼škoa-static
* é¡¹ç›®çƒ­æ›´æ–°
  * devï¼šnodemon
  * prodï¼špm2



### IIã€å¼€å§‹å®ç°

#### Step1ã€å®‰è£…Koa2å¹¶å¯åŠ¨httpæœåŠ¡

å®‰è£…Koa2  

```js
npm install koa
```

åˆ›å»ºBFFç¨‹åºå…¥å£æ–‡ä»¶ï¼Œapp.js   

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();

app.use(ctx => {
  ctx.body = 'hello koa!';
});
 
app.listen(3000, function() {
  console.log("Server is running at http://localhost:3000.");
});
```

åœ¨ç»ˆç«¯é‡Œè¾“å…¥ï¼š`node app.js` å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼Œç„¶åæ‰“å¼€æµè§ˆå™¨åœ¨åœ°å€æ è¾“å…¥`localhost:3000`ï¼Œä½ ä¼šçœ‹è§ç†Ÿæ‚‰çš„ `hello koa`ã€‚  

<img src="../assets/images/chapter9/node-app.png" alt="node-app.png" style="zoom:50%;" />

<img src="../assets/images/chapter9/hello-koa.png" alt="hello-koa" style="zoom:30%;" />

æ‰§è¡Œç»“æœå¦‚å›¾æ‰€ç¤º  

#### Step2ã€é¡¹ç›®ç¯å¢ƒçš„åŒºåˆ†

ä¸€èˆ¬å¼€å‘ä¸­ï¼Œç¯å¢ƒåˆ†ä¸ºå¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰å’Œç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰ã€‚

åŒºåˆ†ç¯å¢ƒæˆ‘ä»¬è¦åœ¨configç›®å½•ä¸‹æ–°å»ºindex.js.     

åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆçœ‹ä»£ç ï¼š  

```js
/* config/index.js */
let config = {};
// åœ¨nodeä¸­åŒºåˆ†ç¯å¢ƒä¸€èˆ¬ä½¿ç”¨process.env.NODE_ENVçš„å€¼æ¥è¿›è¡Œåˆ¤æ–­ï¼ˆè¿™ä¸€ç‚¹æ˜¯èµ°å‘å·¥ç¨‹åŒ–çš„ç¬¬ä¸€æ­¥ï¼Œé‡è¦ç¨‹åº¦ä¸è¨€è€Œå–»ï¼‰ã€‚
// ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œprocess.env.NODE_ENVå‚æ•°æ˜¯åœ¨è„šæœ¬å‘½ä»¤ï¼ˆpackage.jsonä¸­çš„"script"é¡¹ï¼‰å¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ³¨å…¥çš„ã€‚
if(process.env.NODE_ENV === "development"){
  const devConfig = {
    port: 3000
  };
  config = {
    ...config,
    ...devConfig
  }
}
if(process.env.NODE_ENV === "production"){
  const prodConfig = {
    port: 8080
  };
  config = {
    ...config,
    ...prodConfig
  }
}
// è¿™é‡Œä½¿ç”¨çš„æ˜¯CommonJSè¯­æ³•ï¼Œå› ä¸ºNodeæ˜¯å¤©ç”Ÿæ”¯æŒCommonJSçš„ã€‚
// node12ä¹‹åæŠŠ.jsæ–‡ä»¶çš„åç¼€æ”¹æˆ.mjsæ˜¯å¯ä»¥æ”¯æŒESModuleçš„ã€‚
module.exports = config;
```

åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å®ç°äº†é¡¹ç›®ç¯å¢ƒçš„åŒºåˆ†ï¼Œå¹¶ä¸”æˆ‘ä»¬å®ç°äº†ä¸åŒç¯å¢ƒå¯¹åº”ä¸åŒçš„ç«¯å£å·ã€‚ç›¸åº”çš„æˆ‘ä»¬çš„ç¨‹åºå…¥å£æ–‡ä»¶app.jsä¹Ÿæ˜¯éœ€è¦æ›´æ”¹çš„ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬show codeï¼  

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();
// å¼•å…¥configç›®å½•ä¸‹çš„index.jsé…ç½®æ–‡ä»¶
const config = require("./config");

app.use(ctx => {
  ctx.body = 'hello koa!';
});

app.listen(config.port, function() {
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

æˆ‘ä»¬ä¿®æ”¹äº†app.jsï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åŒºåˆ†ç¯å¢ƒè¿˜éœ€è¦åœ¨è„šæœ¬å‘½ä»¤ä¸­æ³¨å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚  

```json
/* package.json */
{
  "name": "BFF-Project",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "scripts": {
    "start": "NODE_ENV=development node ./app.js"
  },
  "dependencies": {}
}
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨package.jsonä¸­æ·»åŠ äº†`"script"`è„šæœ¬é¡¹ï¼Œå¹¶å£°æ˜äº†ä¸€ä¸ª`start`å‘½ä»¤ï¼Œåœ¨å‘½ä»¤ä¸­æ³¨å…¥`NODE_ENV`ç¯å¢ƒå˜é‡ä¸º`development`ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è®¿é—®`process.env.NODE_ENV`å°±ä¼šå¾—åˆ°`â€œdevelopentâ€`ï¼Œè¿™å°±æ˜¯ç¯å¢ƒå‘¢å˜é‡çš„æ³¨å…¥ã€‚`node ./app.js`ï¼Œæ‰§è¡Œapp.jsï¼Œå¯åŠ¨httpæœåŠ¡å™¨ã€‚

æ­¤å¤–æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®ç¯å¢ƒå˜é‡çš„ä¸åŒå£°æ˜å¤šä¸ªè„šæœ¬å‘½ä»¤ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä¸ºå¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒä»¥åŠç”Ÿäº§ç¯å¢ƒå„è‡ªé…ç½®é¡¹ç›®çš„å¯åŠ¨å‘½ä»¤ï¼š

* developmentï¼š"start": "NODE_ENV=development node ./app.js"
* testï¼š"test": "NODE_ENV=test node ./app.js"
* productionï¼š"dev": "NODE_ENV=production node ./app.js"

```json
/* package.json */
{
  "name": "BFF-Project",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "scripts": {
    "start": "NODE_ENV=production node ./app.js",
    "dev": "NODE_ENV=development node ./app.js",
    "test": "NODE_ENV=test node ./app.js",
  },
  "dependencies": {}
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ä»£ç ï¼Œä¸ºæ¯ä¸ªç¯å¢ƒéƒ½é…ç½®äº†å¯åŠ¨æœåŠ¡çš„å‘½ä»¤ï¼Œä¸åŒçš„æ˜¯æ³¨å…¥çš„NODE_DEVä¸åŒã€‚  

> æ³¨æ„ï¼šç°åœ¨æˆ‘ä»¬å­˜åœ¨äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡æ›´æ”¹å®Œä»£ç ä¹‹åæˆ‘ä»¬éƒ½éœ€è¦é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œæ”¹åŠ¨æ‰èƒ½ç”Ÿæ•ˆï¼Œæˆ‘ä»¬çš„æƒ³æ³•æ˜¯æœ€å¥½èƒ½å¤Ÿæœ‰ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿç›‘å¬ä»£ç çš„å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨nodemonæ¥è¿è¡Œæˆ‘ä»¬çš„app.jsï¼Œnodemonå¯ä»¥ç›‘å¬ä»£ç çš„å˜åŒ–ï¼Œèƒ½å¤Ÿçƒ­æ›´æ–°ç¨‹åºï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œæ›´æ–°åçš„ä»£ç å°±å¯ä»¥ç”Ÿæ•ˆã€‚

> nodemonçš„å®‰è£…ï¼š  
>
> ```
> $ sudo npm install nodemon -g 
> ```
>
>  å…¨å±€å®‰è£…nodemonï¼Œå®‰è£…ä¹‹åè¿è¡Œnodemonå¯èƒ½ä¼šæç¤º command not foundã€‚  
>
> è§£å†³åŠæ³•ï¼š  
>
> ```
> $ npm config set prefix /usr/local
> $ sudo npm install nodemon -g
> ```

æˆ‘ä»¬åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨nodemonç›‘å¬ä»£ç çš„å˜æ›´è¿›è¡Œçƒ­æ›´æ–°ï¼Œç”Ÿäº§ç¯å¢ƒåˆ™éœ€è¦ä½¿ç”¨pm2ã€‚  



#### Step3ã€è·¯ç”±

koa2å¯¹åº”çš„è·¯ç”±å¤„ç†ä¸€èˆ¬ä½¿ç”¨koa-routerä¸­é—´ä»¶ã€‚koa-routerå°±æ˜¯é…åˆkoaä½¿ç”¨çš„ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨koa-routerçš„æœ€æ–°ç‰ˆï¼Œå½“å‰koa-routerçš„æœ€æ–°ç‰ˆæœ¬æ˜¯@koa-routerã€‚  

æˆ‘ä»¬æ˜¯ç”¨ `npm install @koa/router`  æ¥å®‰è£…koa-routerã€‚å®‰è£…å¥½ä¹‹åï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹koa-routerã€‚ä¸åºŸè¯ç›´æ¥ä¸Šä»£ç ã€‚  

```javascript
/* app.js */
const Koa = require("koa");
// å¼•å…¥@koa/router
const Router = require("@kou/router");
const app = new Koa();
// å®ä¾‹åŒ–routerå¯¹è±¡
const router = new Router();
const config = require("./config");

// è®¿é—®http://localhost:3000/ é¡µé¢ä¼šæ˜¾ç¤ºhello world
router.get('/', (ctx, next) => {
  ctx.body = 'hello world!';
});

// ä½¿ç”¨routerä¸­é—´ä»¶ï¼Œéœ€è¦useä¸€ä¸‹ã€‚
app
  .use(router.routes())
  .use(router.allowedMethods());

app.listen(config.port, function() {
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

å¼•å…¥@koa/routerä¹‹åæˆ‘ä»¬å°±è¦å¼€å§‹åœ¨controllersä¸­ç¼–å†™æ§åˆ¶routerçš„é€»è¾‘ï¼Œä¸Šæ–‡ä¸­æˆ‘ä»¬å·²ç»è¯´æ˜äº†controlleræ˜¯æ§åˆ¶è·¯ç”±çš„ã€‚æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè·¯ç”±çš„åŸºç±»ï¼ˆcontrollers/Controller.jsï¼‰ï¼Œæ‰€æœ‰çš„è·¯ç”±éƒ½ç»§æ‰¿è‡ªè¿™ä¸ªè·¯ç”±ã€‚  

åœ¨controllersç›®å½•é‡Œæ–°å»ºä¸€ä¸ªController.jsæ–‡ä»¶ã€‚ç›´æ¥ä¸Šä»£ç ï¼š

```javascript
/* controllers/Controller.js */
class Controller{
  log() {
    console.log('logæ‰“å°');
  }
}

module.exports = Controller;
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ControlleråŸºç±»ä¸­ä»€ä¹ˆé€»è¾‘ä¹Ÿæ²¡æœ‰ï¼Œåªæœ‰ä¸€ä¸ªæ—¥å¿—æ‰“å°åŠŸèƒ½ã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šè®²åˆ°ã€‚ç¼–å†™å¥½åŸºç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™å¯¹åº”çš„è·¯ç”±é€»è¾‘äº†ã€‚æˆ‘ä»¬å¯ä»¥æ‹¿indexè·¯ç”±ä¸¾ä¾‹ï¼š  

åœ¨controllersç›®å½•ä¸­æ–°å»ºIndexController.jsï¼Œç›´æ¥çœ‹ä»£ç ï¼š

```javascript
/* controllers/IndexController */
// å¼•å…¥ControlleråŸºç±»
const Controller = require('./Controller');
// IndexControllerç»§æ‰¿è‡ªControlleråŸºç±»
class IndexController extends Controller {
  constructor() {
    super();
  }
  
  // æ ¹æ®indexè·¯ç”±æ¸²æŸ“é¡µé¢çš„å‡½æ•°ï¼ˆç±»æ¯”yiiçš„actionIndexæ–¹æ³•ï¼‰
  actionIndex() {
    // todo...
  }
}

module.exports = IndexController;
```

ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•æŠŠåœ°å€ä¸Šçš„è¾“å…¥å’Œcontrollerè”ç³»èµ·æ¥ï¼Œæ¯«æ— ç–‘é—®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è·¯ç”±ã€‚  

æˆ‘ä»¬åœ¨controllersç›®å½•ä¸­æ–°å»ºindex.jsï¼Œç»Ÿä¸€å¯¹æ‰€æœ‰çš„è·¯ç”±è¿›è¡Œå¤„ç†ï¼ŒåŒ¹é…å„è‡ªçš„controllerã€‚ä½ ä¼šå‘ç°æ‰€æœ‰çš„mvcæ¡†æ¶éƒ½æ˜¯è¿™ä¹ˆåšçš„ï¼Œæ¯”å¦‚phpçš„yiiæ¡†æ¶ã€‚yiiæˆ‘ä»¬ä¹‹å‰å·²ç»è®²åˆ°äº†ã€‚åœ¨controllersä¸­æ–°å»ºindex.jsã€‚  

```javascript
/* controllers/index.js */

// å¼•å…¥Routerä¸­é—´ä»¶
const Router = require("@koa/router");
// å®ä¾‹åŒ–routerå¯¹è±¡
const router = new Router();

//å®šä¹‰åˆå§‹åŒ–çš„è·¯ç”±å…¥å£ï¼Œä¼ å…¥appå®ä¾‹
initController(app) {
  // åŒæ ·æˆ‘ä»¬åœ¨ä½¿ç”¨koa-routerçš„æ—¶å€™è¦useä¸€ä¸‹
  app
    .use(router.routes())
    .use(router.allowedMethods());
}

// å¯¼å‡ºinitControllerï¼Œåœ¨app.jsä¸­å¼•å…¥å¹¶æ‰§è¡Œ
module.exports = initController;
```

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹app.jsä¸­åº”è¯¥æ€ä¹ˆå†™ã€‚ä¸Šä»£ç ï¼š  

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();
const config = require('./config');
const initController = require('./controllers');

initController(app);

app.listen(config.port, function() { Â 
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

å¤„ç†å®Œapp.jsæˆ‘ä»¬æ”¹å†™ä¸€ä¸‹controllers/index.jsã€‚  

```javascript
/* controllers/index.js */

// å¼•å…¥Routerä¸­é—´ä»¶
const Router = require("@koa/router");
// å®ä¾‹åŒ–routerå¯¹è±¡
const router = new Router();

//å®šä¹‰åˆå§‹åŒ–çš„è·¯ç”±å…¥å£ï¼Œä¼ å…¥appå®ä¾‹
initController(app) {
  router.get('/', (ctx, next) => {
    ctx.body = 'hello world!!!'
  });
  
  // åŒæ ·æˆ‘ä»¬åœ¨ä½¿ç”¨koa-routerçš„æ—¶å€™è¦useä¸€ä¸‹
  app
    .use(router.routes())
  	// ä¸»è¦æ˜¯å¯¹httpçš„è¯·æ±‚å¤´æœ‰å½±å“
    .use(router.allowedMethods());
}

// å¯¼å‡ºinitControllerï¼Œåœ¨app.jsä¸­å¼•å…¥å¹¶æ‰§è¡Œ
module.exports = initController;
```

è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬æƒ³è¦æŠŠcontrollerå’Œurlå…³è”èµ·æ¥æˆ‘ä»¬å°±åœ¨controllers/index.jså¼•å…¥å„ç§çš„controlleræ§åˆ¶å™¨ã€‚  

```javascript
/* controllers/index.js */

// å¼•å…¥Routerä¸­é—´ä»¶
const Router = require("@koa/router");

// å¼•å…¥controller  IndexController
const IndexController = require('./IndexController');

// å®ä¾‹åŒ–IndexController
const indexController = new IndexController();

// å®ä¾‹åŒ–routerå¯¹è±¡
const router = new Router();

//å®šä¹‰åˆå§‹åŒ–çš„è·¯ç”±å…¥å£ï¼Œä¼ å…¥appå®ä¾‹
initController(app) {
  // åœ¨è¿™é‡Œç»™è·¯ç”±æ³¨å†Œä¸€ä¸ªè·¯ç”±å¤„ç†å‡½æ•°ï¼Œè¿™ä¸€æ­¥æ˜¯çœŸæ­£çš„æŠŠè·¯ç”±å’Œcontrollerä¸­çš„actionä¹Ÿå°±æ˜¯åŠ¨ä½œè”ç³»åœ¨ä¸€èµ·ï¼Œæ˜¯ä¸€ç§æ˜ å°„å…³ç³»ã€‚
  // æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ˜¯æŠŠindexControllerä¸­çš„actionIndexæ–¹æ³•æ•´ä¸ªå½“åšå‚æ•°ä¼ å…¥ï¼Œè¿™æ ·çš„è¯actionIndexæ–¹æ³•å°±è‡ªåŠ¨çš„æ¥æ”¶äº†ctxå’Œnextä¸¤ä¸ªå‚æ•°
  router.get('/', indexController.actionIndex);
  // å¦‚æœéœ€è¦æ›´å¤šçš„è·¯ç”±çš„æ˜ å°„ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™é‡Œæ·»åŠ 
  // router.get('/about', aboutController.actionAbout);
  
  // åŒæ ·æˆ‘ä»¬åœ¨ä½¿ç”¨koa-routerçš„æ—¶å€™è¦useä¸€ä¸‹
  app
    .use(router.routes())
  	// ä¸»è¦æ˜¯å¯¹httpçš„è¯·æ±‚å¤´æœ‰å½±å“
    .use(router.allowedMethods());
}

// å¯¼å‡ºinitControllerï¼Œåœ¨app.jsä¸­å¼•å…¥å¹¶æ‰§è¡Œ
module.exports = initController;
```

æˆ‘ä»¬å†è¡¥å……ä¸€ä¸‹IndexControllerä¸­çš„todoéƒ¨åˆ†ï¼š  

```javascript
/* controllers/IndexController */
// å¼•å…¥ControlleråŸºç±»
const Controller = require('./Controller');
// IndexControllerç»§æ‰¿è‡ªControlleråŸºç±»
class IndexController extends Controller {
  constructor() {
    super();
  }
  
  // æ ¹æ®indexè·¯ç”±æ¸²æŸ“é¡µé¢çš„å‡½æ•°ï¼ˆç±»æ¯”yiiçš„actionIndexæ–¹æ³•ï¼‰
  actionIndex(ctx, next) {
    ctx.body = 'action index';
  }
}

module.exports = IndexController;
```

åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬æŠŠè·¯ç”±å’Œcontrollerè”ç³»èµ·æ¥äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜åšäº†å¾ˆå¥½çš„æ‰©å±•ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦ç»™ä¸åŒçš„urlè·¯ç”±åŒ¹é…ç›¸åº”çš„æ§åˆ¶å™¨åŠ¨ä½œï¼Œç›´æ¥å¯ä»¥åœ¨controllers/index.jsä¸­çš„initControlleræ–¹æ³•ä¸­æ·»åŠ è·¯ç”±å’Œcontrollerçš„actionæ–¹æ³•çš„æ˜ å°„ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æˆ‘ä»¬ç»™controllerå’Œrouterä¹‹é—´åšäº†ä¸€ä¸ªæ¡¥æ¢ï¼Œå¯ä»¥å¾ˆå¥½çš„è”é€šï¼Œå¹¶ä¸”èƒ½å¾ˆå¥½çš„æ‰©å±•ã€‚  

æˆ‘ä»¬é™¤äº†åœ¨controllersä¸­ç¼–å†™é¡µé¢çš„å¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ æ¥å£çš„å¤„ç†æ–¹æ³•ã€‚  

åœ¨controllersæ–°å»ºä¸€ä¸ªApiController.js  

```javascript
// controller/ApiController.js

// å¼•å…¥ControlleråŸºç±»
const Controller = require('./Controller');
// IndexControllerç»§æ‰¿è‡ªControlleråŸºç±»
class ApiController extends Controller {
  constructor() {
    super();
  }
  
  // æ ¹æ®indexè·¯ç”±æ¸²æŸ“é¡µé¢çš„å‡½æ•°ï¼ˆç±»æ¯”yiiçš„actionIndexæ–¹æ³•ï¼‰
  actionDataList(ctx, next) {
    ctx.body = [
      {
        id: 1,
        data: '1'
      },
      {
        id: 2,
        data: '2'
      },
      ...
    ];
  }
}

module.exports = IndexController;
```

æ¥å£çš„Controllerå†™å¥½ä¹‹åï¼Œä½¿ç”¨çš„æ–¹å¼å’Œé¡µé¢çš„è·¯ç”±ä¸€æ¨¡ä¸€æ ·ã€‚  

```javascript
/* controllers/index.js */

const Router = require("@koa/router");
const IndexController = require('./IndexController');
const indexController = new IndexController();
// å¼•å…¥ApiController
const ApiController = require('./ApiController');
const apiController = new ApiController();

const router = new Router();

initController(app) {
  
  router.get('/', indexController.actionIndex);
  // çº¦å®šä¿—æˆçš„æ¥å£è·¯ç”±ä»¥apiä¸ºå‰ç¼€ï¼Œéƒ½ä¸º/api/...
  router.get('/api/getDataList', apiController.actionDataList);
  
  app
    .use(router.routes())
    .use(router.allowedMethods());
}

module.exports = initController;
```

åˆ°äº†è¿™é‡Œæˆ‘ä»¬çš„è·¯ç”±å·²ç»æ­å»ºå®Œæ¯•ï¼Œå¹¶ä¸”å®Œæˆäº†è·¯ç”±å’Œcontrollerå…³ç³»çš„å»ºç«‹ã€‚ä¸‹é¢å°±æ˜¯Viewå±‚çš„ç¼–å†™äº†ã€‚  



#### step4 Viewæ¨¡æ¿

åˆšæ‰æˆ‘ä»¬è¾“å…¥urlåªæ˜¯åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç°åœ¨æˆ‘ä»¬è¦æ˜¾ç¤ºä¸€ä¸ªçœŸæ­£çš„é¡µé¢ã€‚  

* æ–¹æ³•ä¸€ï¼šç›´æ¥åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æˆ‘ä»¬çš„htmlä»£ç ã€‚
* æ–¹æ³•äºŒï¼šåˆ©ç”¨æ¨¡æ¿å¼•æ“ï¼Œè¿™é‡Œæˆ‘ä»¬æ¨èä½¿ç”¨swigæ¨¡æ¿ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ–¹æ³•ä¸€ï¼š  

```javascript
/* controllers/IndexController */
// å¼•å…¥ControlleråŸºç±»
const Controller = require('./Controller');
// IndexControllerç»§æ‰¿è‡ªControlleråŸºç±»
class IndexController extends Controller {
  constructor() {
    super();
  }
  
  // æ ¹æ®indexè·¯ç”±æ¸²æŸ“é¡µé¢çš„å‡½æ•°ï¼ˆç±»æ¯”yiiçš„actionIndexæ–¹æ³•ï¼‰
  actionIndex(ctx, next) {
    ctx.body = `
				<html>
					<body>
						<h1>index</h1>
					</body>
				</html>
		`;
  }
}

module.exports = IndexController;
```

æ–¹æ³•ä¸€æ˜¯ç›´æ¥åœ¨ç»™ctx.bodyèµ‹å€¼ä¸€ä¸ªhtmlå­—ç¬¦ä¸²ã€‚è¿™ç§æ–¹å¼æ— ç–‘æ˜¯æœ€ç®€å•çš„ï¼Œä½†æ˜¯åŒæ—¶å®ƒä¸å¤ªçµæ´»ã€‚  

æˆ‘ä»¬æ›´å¸Œæœ›çš„æ˜¯åƒå¹³æ—¶æˆ‘ä»¬å†™é™æ€ç½‘é¡µä¸€æ ·ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„æˆ‘ä»¬å°±è¦ä½¿ç”¨æ¨¡æ¿ï¼Œswigã€‚  

æ–¹æ³•äºŒï¼šä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥swigä¸ºä¾‹ï¼Œkoa-swigã€‚  

æˆ‘ä»¬å…ˆæ¥å®‰è£…kao-swigï¼Œä½¿ç”¨ `npm install koa-swig` æ¥å®‰è£…koa-swigï¼Œè¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ä¸€ä»¶äº‹æƒ…ï¼Œä½¿ç”¨koa2çš„æ—¶å€™ï¼Œswigå¯¹åº”çš„æ˜¯koa2çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬è¿˜éœ€è¦ä¸€ä¸ª`co`åº“æ¥é…åˆä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `npm install co` æ¥å®‰è£…coåº“ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹å¼æˆ‘ä»¬ä¼šè´´å‡ºä»£ç ï¼Œå®‰è£…å¥½æ—¶å€™æˆ‘ä»¬å¼€å§‹ç¼–å†™ã€‚  

æˆ‘ä»¬ç°åœ¨app.jsä¸­å¼•å…¥å¹¶é…ç½®å¥½koa-swigã€‚  

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();
// å¼•å…¥koa-swig
const render = require("koa-swig");
// å¼•å…¥coæ¨¡å—
const co = require('co');
const config = require('./config');
const initController = require('./controllers');

// æŠŠkoa-swigæŒ‚è½½åˆ°contextä¸Šï¼Œå¹¶é…ç½®koa-swigã€‚è¦ç”¨coæ¨¡å—åŒ…è£¹ï¼ï¼
// å› ä¸ºæ¨¡æ¿çš„æ¸²æŸ“æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥éœ€è¦coçš„åŒ…è£¹ï¼Œcoåº“å°±æ˜¯æ¥å¤„ç†å¼‚æ­¥è°ƒç”¨çš„ã€‚è¿™é‡Œä¸è¯¦ç»†è§£é‡Šã€‚
app.context.render = co.wrap(render({
  root: path.join(__dirname, 'views'),
  cache: 'memory', // disable, set to false æ˜¯å¦éœ€è¦ç¼“å­˜ï¼Œå¼€å‘ç¯å¢ƒä¸éœ€è¦ç¼“å­˜ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦ç¼“å­˜ã€‚æ ¹æ®ç¯å¢ƒä¸åŒåšä¸åŒçš„é…ç½®ã€‚
}))

initController(app);

app.listen(config.port, function() { Â 
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

è¿™é‡Œkoa-swigçš„é…ç½®ï¼Œæˆ‘ä»¬å»ºè®®æ”¾åœ¨configä¸­è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ï¼Œcacheæœ¬èº«å°±éœ€è¦æ ¹æ®ä¸åŒçš„ç¯å¢ƒåšä¸åŒçš„é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒä¸º'memory'ï¼Œå¼€å‘ç¯å¢ƒä¸ºfalseã€‚ 

æˆ‘ä»¬æŠŠkoa-swigçš„é…ç½®é¡¹æ”¾åœ¨configä¸­ã€‚   

```javascript
/* config/index.js */

// å¼•å…¥nodeçš„pathæ¨¡å—
const path = require('path');

let config = {
  // æ¨¡æ¿çš„è·¯å¾„ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒç›¸åŒ
  viewDir: path.join(__dirname, '../', 'views');
};
// åœ¨nodeä¸­åŒºåˆ†ç¯å¢ƒä¸€èˆ¬ä½¿ç”¨process.env.NODE_ENVçš„å€¼æ¥è¿›è¡Œåˆ¤æ–­ï¼ˆè¿™ä¸€ç‚¹æ˜¯èµ°å‘å·¥ç¨‹åŒ–çš„ç¬¬ä¸€æ­¥ï¼Œé‡è¦ç¨‹åº¦ä¸è¨€è€Œå–»ï¼‰ã€‚
// ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œprocess.env.NODE_ENVå‚æ•°æ˜¯åœ¨è„šæœ¬å‘½ä»¤ï¼ˆpackage.jsonä¸­çš„"script"é¡¹ï¼‰å¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ³¨å…¥çš„ã€‚
if(process.env.NODE_ENV === "development"){
  const devConfig = {
    port: 3000,
    // æ¨¡æ¿ç¼“å­˜åœ¨å¼€å‘ç¯å¢ƒä¸éœ€è¦
    cache: false,
  };
  config = {
    ...config,
    ...devConfig
  }
}
if(process.env.NODE_ENV === "production"){
  const prodConfig = {
    port: 8080,
    // åœ¨ç”Ÿäº§ç¯å¢ƒéœ€è¦ç¼“å­˜æ¨¡æ¿
    cache: 'memory',
  };
  config = {
    ...config,
    ...prodConfig
  }
}
// è¿™é‡Œä½¿ç”¨çš„æ˜¯CommonJSè¯­æ³•ï¼Œå› ä¸ºNodeæ˜¯å¤©ç”Ÿæ”¯æŒCommonJSçš„ã€‚
// node12ä¹‹åæŠŠ.jsæ–‡ä»¶çš„åç¼€æ”¹æˆ.mjsæ˜¯å¯ä»¥æ”¯æŒESModuleçš„ã€‚
module.exports = config;
```

é…ç½®å¥½koa-swigçš„é…ç½®ï¼Œæˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹app.jsä¸­å…³äºkoa-swigçš„é…ç½®ã€‚  

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();
const render = require("koa-swig");
const co = require('co');
const config = require('./config');
const initController = require('./controllers');

app.context.render = co.wrap(render({
  root: config.viewDir,
  cache: config.cache,
}));

initController(app);

app.listen(config.port, function() { Â 
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥ç¼–å†™ä¸€ä¸ªæ¨¡æ¿ï¼Œåœ¨viewsç›®å½•ä¸­æ–°å»ºä¸€ä¸ªindex.html.  

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BFFæ¶æ„é¦–é¡µ</title>
</head>
<body>
  <h1>BFFæ¶æ„é¦–é¡µ</h1>
</body>
</html>
```

åˆ›å»ºå¥½æ¨¡æ¿ä¹‹åï¼Œæˆ‘ä»¬è¦åœ¨IndexControllerä¸­æ¸²æŸ“æ¨¡æ¿ã€‚  

```javascript
/* controllers/IndexController */

const Controller = require('./Controller');

class IndexController extends Controller {
  constructor() {
    super();
  }
  
  actionIndex(ctx, next) {
    // æŠŠctx.render()ä¹‹åçš„ç»“æœèµ‹å€¼ç»™ctx.body
    ctx.body = ctx.render('index'); //è¿™é‡Œçš„å‚æ•°ä¹Ÿå¯ä»¥æ”¯æŒå¤šå±‚ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œå¾€æ¨¡æ¿ä¸­åŠ¨æ€æ¸²æŸ“æ•°æ®ã€‚
  }
}

module.exports = IndexController;
```

ç°åœ¨æˆ‘ä»¬ä»Controllerå±‚åˆ°Viewå±‚å°±å…³è”èµ·æ¥äº†ã€‚åˆ°æ­¤æˆ‘ä»¬å°±æŠŠmvcçš„æ¶æ„æ­å»ºå®Œæˆäº†ã€‚æ­å–œå„ä½è¯»è€…ï¼ŒåšæŒåˆ°è¿™é‡Œä¸å®¹æ˜“ï¼Œç»™ä½ ä»¬ä¸€æœµå°çº¢èŠ±ğŸŒ·ã€‚  

åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬åˆ©ç”¨nodeçš„æœåŠ¡å®Œå…¨å¯ä»¥æŠŠé¡µé¢æ¸²æŸ“å‡ºæ¥å¹¶ä¸éœ€è¦nginxæœåŠ¡å™¨ä¹‹ç±»çš„ï¼Œä¸è®ºvueçš„spaé¡¹ç›®æˆ–è€…æ˜¯æ™®é€šçš„mpaé¡¹ç›®ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨nodeæ¥æ¸²æŸ“å‡ºæ¥ã€‚  



#### æ‰©å±•ç¯‡ï¼ˆå¦‚ä½•ç”¨nodeæ¥æ¸²æŸ“vueçš„spaé¡¹ç›®ï¼‰

* å…ˆåˆ›å»ºä¸€ä¸ªvueé¡¹ç›®
* æŠŠnpmé¡¹ç›®æ‰“åŒ…ç¼–è¯‘å¥½ï¼Œå‘½ä»¤ï¼š`npm run build`
* æŠŠæ‰“åŒ…å¥½çš„distç›®å½•ä¸­çš„æ–‡ä»¶æ”¾è¿›node serverçš„assetsç›®å½•ä¸­ã€‚
* æŠŠvueé¡¹ç›®ä¸­çš„index.htmlæ–‡ä»¶å•ç‹¬æ‹¿å‡ºæ¥æ”¾è¿›views/vueç›®å½•ä¸­ã€‚
* ç„¶åä½¿ç”¨ä¸Šæ–‡ä¸­æ­å¥½çš„mvcæ¡†æ¶è¿›è¡Œæ¸²æŸ“ã€‚

ç°åœ¨æˆ‘ä»¬åœ¨urlä¸­è¾“å…¥ç›¸åº”çš„è·¯ç”±ï¼Œåº”è¯¥æ˜¯ç©ºç™½é¡µé¢çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› å°±æ˜¯æˆ‘ä»¬çš„æ‰€æœ‰çš„é™æ€æ–‡ä»¶éƒ½æ”¾è¿›äº†assetsä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šé™æ€æ–‡ä»¶çš„å­˜æ”¾ç›®å½•ï¼Œç°åœ¨æˆ‘ä»¬å°±æŒ‡å®šä¸€ä¸‹é™æ€æ–‡ä»¶çš„å­˜æ”¾ä½ç½®ã€‚  

è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ°koa-staticæ’ä»¶ã€‚  

ä½¿ç”¨`npm install koa-static ` å®‰è£…é™æ€æ–‡ä»¶æœåŠ¡å™¨ã€‚ç„¶åæˆ‘ä»¬æ¥ä½¿ç”¨å®ƒã€‚

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();
const render = require("koa-swig");
const co = require('co');
// å¼•å…¥koa-static
const staticServer = require("koa-static");
const config = require('./config');
const initController = require('./controllers');

// æˆ‘ä»¬åŒæ ·æŠŠé™æ€èµ„æºçš„ç›®å½•é…ç½®åœ¨configä¸­ï¼Œconfigé…ç½®æ–‡ä»¶è§ä¸‹æ–‡ã€‚ã€‚
app.use(staticServer(config.staticDir));

app.context.render = co.wrap(render({
  root: config.viewDir,
  cache: config.cache,
}));

initController(app);

app.listen(config.port, function() { Â 
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

```javascript
/* config/index.js */

const path = require('path');

let config = {
  viewDir: path.join(__dirname, '../', 'views'),
  // é™æ€èµ„æºè·¯å¾„ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒç›¸åŒ
  staticDir: path.join(__dirname, '../', 'assets'),
};

if(process.env.NODE_ENV === "development"){
  const devConfig = {
    port: 3000,
    cache: false,
  };
  config = {
    ...config,
    ...devConfig
  }
}
if(process.env.NODE_ENV === "production"){
  const prodConfig = {
    port: 8080,
    cache: 'memory',
  };
  config = {
    ...config,
    ...prodConfig
  }
}

module.exports = config;
```

ç°åœ¨æˆ‘ä»¬è®¿é—®http://localhost:3000ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬èƒ½å¤Ÿæ­£å¸¸è®¿é—®é¡µé¢ã€‚  ä½†æ˜¯ç°åœ¨å­˜åœ¨ç€ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œç°åœ¨æˆ‘ä»¬åˆ‡æ¢åˆ°abouté¡µé¢çš„æ—¶å€™ï¼Œåˆ·æ–°æµè§ˆå™¨ï¼Œä½ ä¼šå‘ç°é¡µé¢è®¿é—®ä¸åˆ°äº†ã€‚  

å…¶å®è¿™ä¸ªé—®é¢˜çš„åŸå› å¾ˆç®€å•ï¼Œåœ¨abouté¡µé¢åˆ·æ–°ï¼Œå®é™…ä¸Šå°±æ˜¯è¯·æ±‚äº†åç«¯/aboutè·¯ç”±ï¼Œæˆ‘ä»¬åç«¯å¹¶æ²¡æœ‰aboutçš„çœŸæ­£è·¯ç”±ï¼Œæ‰€ä»¥mvcçš„æ¶æ„åœ¨æ”¶åˆ°/aboutè·¯ç”±æ—¶å¹¶ä¸çŸ¥é“è¦æ¸²æŸ“ä»€ä¹ˆï¼Œ/aboutçš„è¿™ä¸ªè·¯ç”±å®é™…ä¸Šæ˜¯å‰ç«¯çš„å‡è·¯ç”±ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¯´å‰ç«¯spaé¡¹ç›®éƒ½æ˜¯å‡è·¯ç”±çš„åŸå› ã€‚  

å½“æˆ‘ä»¬è®¿é—®é¦–é¡µï¼Œå†åˆ‡æ¢è·¯ç”±çš„æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°å°±èƒ½å¤Ÿæ­£å¸¸çœ‹åˆ°é¡µé¢ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è®¿é—®è·Ÿè·¯ç”±çš„æ—¶å€™ä¼šæŠŠæ‰€æœ‰çš„é™æ€æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚æ‰€ä»¥æˆ‘ä»¬æ˜¯çœ‹åˆ°çš„æ˜¯æ­£å¸¸çš„ã€‚  

è¦è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å°±éœ€è¦è§£å†³ä¸€ä¸‹å‰åç«¯çœŸå‡è·¯ç”±çš„é—®é¢˜äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨koa2-connect-history-api-fallbackè¿™ä¸ªåº“æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚  

é¦–å…ˆ `npm install koa2-connect-history-api-fallback` å®‰è£…è¿™ä¸ªåº“ã€‚è¿™ä¸ªåº“å¯ä»¥è®©æˆ‘ä»¬åœ¨è®¿é—®ä¸å­˜åœ¨çš„è·¯ç”±çš„æ—¶å€™ï¼Œå¯ä»¥é‡å®šå‘åˆ°æŸä¸€ä¸ªå­˜åœ¨çš„è·¯ç”±ã€‚å½“æˆ‘ä»¬è®¿é—®åˆ°aboutè·¯ç”±çš„æ—¶å€™ï¼Œé‡å®šå‘åˆ°è·Ÿè·¯ç”±ã€‚  

ç°åœ¨æˆ‘ä»¬æ¥ä½¿ç”¨è¿™ä¸ªåº“ï¼Œä¸Šä»£ç ï¼š  

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();
const render = require("koa-swig");
const co = require('co');
const staticServer = require("koa-static");
// å¼•å…¥koa2-connect-history-api-fallback
const { historyApiFallback } = require('koa2-connect-history-api-fallback');
const config = require('./config');
const initController = require('./controllers');

// æˆ‘ä»¬åŒæ ·æŠŠé™æ€èµ„æºçš„ç›®å½•é…ç½®åœ¨configä¸­ï¼Œconfigé…ç½®æ–‡ä»¶è§ä¸‹æ–‡ã€‚ã€‚
app.use(staticServer(config.staticDir));
// è®¿é—®ä¸å­˜åœ¨çš„è·¯ç”±æ—¶ï¼Œé‡å®šå‘åˆ°æ ¹è·¯ç”±ï¼Œè®¾ç½®/apiè·¯ç”±ç™½åå•ï¼Œåœ¨è®¿é—®/api/xxxæ—¶ä¸ä¼šé‡å®šå‘åˆ°è·Ÿè·¯ç”±ã€‚
app.use(historyApiFallback(index: '/', { whiteList: ['/api'] }));

app.context.render = co.wrap(render({
  root: config.viewDir,
  cache: config.cache,
}));

initController(app);

app.listen(config.port, function() { Â 
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ¸²æŸ“spaåº”ç”¨äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»™nodeæœåŠ¡åšä¸€ä¸ªå®¹é”™æœºåˆ¶ã€‚  

ç¨ç­‰æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨vueæ¨¡æ¿çš„å·®å€¼è¡¨è¾¾å¼ï¼Œä¼šä¸swigæ¨¡æ¿è¯­æ³•å†²çªã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜swigçš„é…ç½®æ¥æŠŠ`{{}}`ç¬¦å·æ”¹æˆå…¶ä»–çš„ç¬¦å·ã€‚åŸå› æ˜¯æ”¹vueçš„å·®å€¼è¡¨è¾¾å¼éš¾åº¦å¤ªå¤§ã€‚  

#### step4ã€å®¹é”™æœºåˆ¶

æˆ‘ä»¬ç°åœ¨ç»™nodeé¡¹ç›®åšä¸€ä¸ªå®¹é”™æœºåˆ¶ï¼Œä½¿ç”¨ä¸­é—´ä»¶æ¥å®Œæˆï¼Œåœ¨middlewareä¸­æ–°å»ºä¸€ä¸ªErrorHandle.jsã€‚  

```javascript
/* middleware/ErrorHandle.js */

class ErrorHandle {
  static error(app) {
    app.use(async(ctx, next) => {
      try {
        await next();
        if(ctx.status === 404) {
           ctx.body = 'å‹å¥½çš„404é¡µé¢';
        }
      }catch {
        ctx.body = '500è¯·æ±‚ï¼Œæ­£åœ¨ç§¯æä¿®å¤ã€‚'
      }
    })
  }
}

module.exports = ErrorHandle;
```

ç°åœ¨åœ¨app.jsä¸­å¼•å…¥ä¸€ä¸‹ï¼š  

```javascript
/* app.js */
const Koa = require("koa");
const app = new Koa();
const render = require("koa-swig");
const co = require('co');
const staticServer = require("koa-static");
// å¼•å…¥koa2-connect-history-api-fallback
const { historyApiFallback } = require('koa2-connect-history-api-fallback');
const config = require('./config');
const initController = require('./controllers');
const ErrorHandle = require('./middleware/ErrorHandle');

app.use(staticServer(config.staticDir));
app.use(historyApiFallback(index: '/', { whiteList: ['/api'] }));
// ä¼ å…¥app
ErrorHandle.error(app);

app.context.render = co.wrap(render({
  root: config.viewDir,
  cache: config.cache,
}));

initController(app);

app.listen(config.port, function() { Â 
  console.log(`Server is running at http://localhost:${config.port}.`);
});
```

æˆ‘ä»¬å¯ä»¥åœ¨IndexControllerä¸­è‡ªå®šä¹‰ä¸€ä¸ªé”™è¯¯æ¥éªŒè¯ä¸€ä¸‹ï¼š  

```javascript
/* controllers/IndexController */

const Controller = require('./Controller');

class IndexController extends Controller {
  constructor() {
    super();
  }
  
  actionIndex(ctx, next) {
    throw Error('è‡ªå®šä¹‰é”™è¯¯ã€‚');
    // æŠŠctx.render()ä¹‹åçš„ç»“æœèµ‹å€¼ç»™ctx.body
    ctx.body = ctx.render('index'); //è¿™é‡Œçš„å‚æ•°ä¹Ÿå¯ä»¥æ”¯æŒå¤šå±‚ç›®å½•
  }
}

module.exports = IndexController;
```

è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨è®¿é—®è·Ÿè·¯ç”±çš„æ—¶å€™ä¼šå‡ºç°æœåŠ¡å™¨é”™è¯¯ï¼Œå‡ºå‘å®¹é”™æœºåˆ¶ï¼Œé¡µé¢ä¼šå‡ºç° `500è¯·æ±‚ï¼Œæ­£åœ¨ç§¯æä¿®å¤ã€‚` æˆ‘ä»¬æŠŠspaé‡å®šå‘çš„ä»£ç å¹²æ‰ï¼Œå¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯ç”±ï¼Œä¼šå‡ºç°404é¡µé¢ã€‚  

åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬æŠŠå®¹é”™ä¹Ÿå¤„ç†å®Œæˆäº†ã€‚  



#### step5ã€ES6ã€babelã€system.jsé‡æ„é¡¹ç›®

ç°åœ¨chromeæµè§ˆå™¨å·²ç»åŸç”Ÿæ”¯æŒes6æ¨¡å—åŒ–äº†ã€‚æˆ‘ä»¬é¦–å…ˆåœ¨assetsçš„jsç›®å½•ä¸­æ–°å»ºä¸€ä¸ªdata.jsï¼š  

```javascript
/* assets/js/data.js */

export default const data = "å‰ç«¯æ•°æ®";

// ä½¿ç”¨ESmoduleçš„æ–¹å¼å¯¼å‡º
```

è¿™æ ·çš„è¯ï¼Œåªéœ€è¦ç»™htmlæ–‡ä»¶ä¸­çš„scriptæ ‡ç­¾åŠ ä¸Štype="module"å±æ€§å°±å¯ä»¥æ”¯æŒes6çš„æ¨¡å—åŒ–è¯­æ³•ï¼š  

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BFFæ¶æ„é¦–é¡µ</title>
</head>
<body>
  <h1>BFFæ¶æ„é¦–é¡µ</h1>
  <!-- è¿™ç§å†™æ³•ç°åœ¨è¿˜æœ‰ä¸€äº›æµè§ˆå™¨ä¸æ”¯æŒï¼Œè§£å†³æ–¹å¼å°±æ˜¯ä½¿ç”¨babelç¼–è¯‘ï¼Œsystem.jsåŠ è½½ -->
  <script src="https://cdn.bootcdn.net/ajax/libs/systemjs/6.8.3/system.js"></script>
  <script type="module">
    import('/js/data.js').then(res => {
      // å¯ä»¥è¾“å‡ºres
      console.log(res);
    })
  </script>
  <script type="nomodule">
  	console.log('ä¸æ”¯æŒæ¨¡å—åŒ–å¯¼å…¥');
  	// å¦‚æœä¸æ”¯æŒes6æ¨¡å—åŒ–å¯¼å…¥ï¼Œå°±ä½¿ç”¨babelç¼–è¯‘æˆSystemèƒ½å¤Ÿè¯†åˆ«çš„ä»£ç æ ¼å¼ï¼Œç„¶åä½¿ç”¨system.jså¯¼å…¥
  	
  	// æ˜¾ç„¶è¿™æ®µä»£ç åœ¨æµè§ˆå™¨ä¸­ä¼šæŠ¥é”™ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å¯¹data.jsè¿›è¡Œbabelç¼–è¯‘ã€‚ç¨åè¡¥å……...
  	System.import('/js/data.js').thn(res => {
  		console.log(res);
  	})
	</script>
</body>
</html>
```

åœ¨è¿™ä¸€æ­¥æˆ‘ä»¬åœ¨ä¸æ”¯æŒESmoduleçš„æµè§ˆå™¨ä¸­ä½¿ç”¨system.jsçš„è¯ï¼Œéœ€è¦å®‰è£…babelæ¥å¯¹jsä»£ç è¿›è¡Œç¼–è¯‘ã€‚ä½¿ç”¨`npm install --save-dev @babel/plugin-transform-modules-systemjs` æ¥è¿›è¡Œå®‰è£…bebelï¼Œç„¶åè¿˜è¦å®‰è£…babelçš„cliå’Œbabelçš„æ ¸å¿ƒä»£ç æ‰èƒ½æ­£å¸¸ä½¿ç”¨babelï¼Œä½¿ç”¨ `npm install @babel/cli -D` å®‰è£…babel-cliï¼Œä½¿ç”¨ `npm install @babel/core -D` å®‰è£…babel-coreã€‚ å¦å¤–æˆ‘ä»¬è¿˜éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºbabelçš„é…ç½®æ–‡ä»¶.babelrcï¼š  

```javascript
/* .babelrc */

{
  "plugins": ["@babel/plugin-transform-modules-systemjs"]
}
```

æˆ‘ä»¬æ—¢ç„¶æƒ³è¦æ‰“åŒ…ï¼Œå°±éœ€è¦åœ¨package.jsonä¸­åˆ›å»ºä¸€ä¸ªæ‰“åŒ…å‘½ä»¤ï¼š  

```json
/* package.json */
{
  "name": "BFF-Project",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "scripts": {
    "start": "NODE_ENV=development node ./app.js",
    "build": "babel ./assets/js/data.js -o ./assets/js/data-bundle.js"
  },
  "dependencies": {}
}
```

åœ¨å‘½ä»¤è¡Œè¾“å…¥ `npm run build` ä¹‹åï¼Œåœ¨asset/js ç›®å½•ä¸‹å›ç”Ÿæˆä¸€ä¸ªdata-bundle.jsæ–‡ä»¶ï¼Œè¿™å°±æ˜¯system.jsèƒ½å¤Ÿè¯†åˆ«çš„JSä»£ç æ ¼å¼ï¼Œç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹htmlæ–‡ä»¶ï¼š  

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BFFæ¶æ„é¦–é¡µ</title>
</head>
<body>
  <h1>BFFæ¶æ„é¦–é¡µ</h1>
  <!-- è¿™ç§å†™æ³•ç°åœ¨è¿˜æœ‰ä¸€äº›æµè§ˆå™¨ä¸æ”¯æŒï¼Œè§£å†³æ–¹å¼å°±æ˜¯ä½¿ç”¨babelç¼–è¯‘ï¼Œsystem.jsåŠ è½½ -->
  <script src="https://cdn.bootcdn.net/ajax/libs/systemjs/6.8.3/system.js"></script>
  <script type="module">
    import('/js/data.js').then(res => {
      // å¯ä»¥è¾“å‡ºres
      console.log(res);
    })
  </script>
  <script type="nomodule">
  	console.log('ä¸æ”¯æŒæ¨¡å—åŒ–å¯¼å…¥');
  	// å¦‚æœä¸æ”¯æŒes6æ¨¡å—åŒ–å¯¼å…¥ï¼Œå°±ä½¿ç”¨babelç¼–è¯‘æˆSystemèƒ½å¤Ÿè¯†åˆ«çš„ä»£ç æ ¼å¼ï¼Œç„¶åä½¿ç”¨system.jså¯¼å…¥
  	System.import('/js/data-bundle.js').thn(res => {
  		console.log(res);
  	});
	</script>
</body>
</html>
```

æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹å…¶å®æˆ‘ä»¬è¿™ä¹ˆåšçš„ç›®çš„å°±æ˜¯èƒ½å¤Ÿä½¿ç”¨ä¸€äº›æ–°çš„è¯­æ³•ï¼Œæ–°çš„æŠ€æœ¯ã€‚æŠ€æœ¯å‘å±•å¾ˆå¿«æˆ‘ä»¬è¦å°½é‡çš„æ‹¥æŠ±æ–°çš„æŠ€æœ¯ã€‚  

å¯¹äºES6Moduleçš„å…¼å®¹æ€§å¤„ç†ï¼Œgithubä¸Šä¹Ÿæœ‰ä¸€äº›polifyæ¥å¯¹æµè§ˆå™¨åšä¸€äº›å¯¹ES6æ¨¡å—åŒ–å¯¼å…¥çš„å…¼å®¹ã€‚å¤šçœ‹githubä¹Ÿä¼šæœ‰å¾ˆå¤§çš„æ”¶è·ã€‚

